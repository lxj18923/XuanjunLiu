(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[36],{BPeV:function(e,t,a){"use strict";var l=a("TqRt"),r=a("284h");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var n=l(a("bx4M"));a("g9YV");var o=l(a("wCAj"));a("miYZ");var d=l(a("tsqr"));a("/zsF");var i=l(a("PArb"));a("+L6B");var s=l(a("2/Rp")),u=l(a("pVnL")),f=l(a("MVZn")),c=l(a("lwsE")),p=l(a("W8MJ")),m=l(a("a1gu")),h=l(a("Nsbk")),y=l(a("7W2i"));a("2qtc");var k=l(a("kLXV"));a("5NDa");var v=l(a("5rEg"));a("OaEy");var M=l(a("2fM7"));a("ozfa");var g=l(a("MJZm"));a("FJo9");var b=l(a("L41K"));a("y8nQ");var V,E,C,w,F,S,N,T,x=l(a("Vl3Y")),D=r(a("q1tI")),R=a("LLXN"),U=a("MuoO"),L=(l(a("CkN6")),l(a("zHco"))),O=l(a("UwRH")),A=x.default.Item,K=b.default.Step,q=g.default.TreeNode,P=M.default.Option,z=x.default.create()(function(e){var t=e.modalVisible,a=e.form,l=e.handleAdd,r=e.handleModalVisible,n=function(){a.validateFields(function(e,t){e||(a.resetFields(),l(t))})};return D.default.createElement(k.default,{destroyOnClose:!0,title:(0,R.formatMessage)({id:"app.form.create.title"}),visible:t,onOk:n,onCancel:function(){return r()}},D.default.createElement(A,{labelCol:{span:5},wrapperCol:{span:15},label:(0,R.formatMessage)({id:"app.role.form.name"})},a.getFieldDecorator("name",{roles:[{required:!0,message:"\u8bf7\u8f93\u5165\u81f3\u5c11\u4e94\u4e2a\u5b57\u7b26\u7684\u89d2\u8272\u540d\u79f0\uff01",min:5}]})(D.default.createElement(v.default,{placeholder:(0,R.formatMessage)({id:"app.form.placeholder"})}))))}),B=(V=(0,U.connect)(function(e){var t=e.role,a=e.loading;return{role:t,loading:a.models.role}}),E=x.default.create(),V(C=E((w=function(e){function t(e){var a;return(0,c.default)(this,t),a=(0,m.default)(this,(0,h.default)(t).call(this,e)),a.handleNext=function(e){var t=a.props,l=t.form,r=t.handleUpdate,n=a.state.formVals;l.validateFields(function(t,l){if(!t){var o=(0,f.default)({},n,l);a.setState({formVals:o},function(){e<2?a.forward():r(o)})}})},a.backward=function(){var e=a.state.currentStep;a.setState({currentStep:e-1})},a.forward=function(){var e=a.state.currentStep;a.setState({currentStep:e+1})},a.renderTreeNodes=function(e){return e.map(function(e){return null!==e.children?D.default.createElement(q,{title:e.title,key:e.id,dataRef:e},a.renderTreeNodes(e.children)):D.default.createElement(q,{title:e.title,key:e.id,dataRef:e})})},a.onTreeCheck=function(e){var t=a.state.formVals;t["permissions"]=e,a.setState({formVals:t}),a.setState({checkedKeys:e})},a.renderContent=function(e,t){var l=a.props,r=l.form,n=l.role;if(1===e)return 0===a.state.checkedKeys.length&&a.onTreeCheck(n.role.result.permission.select),[D.default.createElement(g.default,{checkable:!0,onCheck:a.onTreeCheck,checkedKeys:a.state.checkedKeys,key:"url"},a.renderTreeNodes(n.permission.result.url))];if(2===e){var o=n.permission.result.data,d=[];for(var i in o)d.push(D.default.createElement(A,(0,u.default)({key:o[i].key},a.formLayout,{label:o[i].title}),r.getFieldDecorator(o[i].key,{initialValue:n.role.result.permission.data[o[i].key]})(D.default.createElement(M.default,{style:{width:"100%"}},o[i].children.map(function(e){return D.default.createElement(P,{value:e.id,key:e.id},e.title)})))));return d}return[D.default.createElement(A,(0,u.default)({key:"name"},a.formLayout,{label:(0,R.formatMessage)({id:"app.role.form.name"})}),r.getFieldDecorator("name",{roles:[{required:!0,message:"\u8bf7\u8f93\u5165\u89c4\u5219\u540d\u79f0\uff01"}],initialValue:t.name})(D.default.createElement(v.default,{placeholder:"\u8bf7\u8f93\u5165"})))]},a.renderFooter=function(e){var t=a.props.handleUpdateModalVisible;return 1===e?[D.default.createElement(s.default,{key:"back",style:{float:"left"},onClick:a.backward},(0,R.formatMessage)({id:"app.modal.previous"})),D.default.createElement(s.default,{key:"cancel",onClick:function(){return t()}},(0,R.formatMessage)({id:"app.modal.cancel"})),D.default.createElement(s.default,{key:"forward",type:"primary",onClick:function(){return a.handleNext(e)}},(0,R.formatMessage)({id:"app.modal.next"}))]:2===e?[D.default.createElement(s.default,{key:"back",style:{float:"left"},onClick:a.backward},(0,R.formatMessage)({id:"app.modal.previous"})),D.default.createElement(s.default,{key:"cancel",onClick:function(){return t()}},(0,R.formatMessage)({id:"app.modal.cancel"})),D.default.createElement(s.default,{key:"submit",type:"primary",onClick:function(){return a.handleNext(e)}},(0,R.formatMessage)({id:"app.modal.ok"}))]:[D.default.createElement(s.default,{key:"cancel",onClick:function(){return t()}},(0,R.formatMessage)({id:"app.modal.cancel"})),D.default.createElement(s.default,{key:"forward",type:"primary",onClick:function(){return a.handleNext(e)}},(0,R.formatMessage)({id:"app.modal.next"}))]},a.state={formVals:{name:e.values.name,id:e.values.id,permissions:[]},currentStep:0,checkedKeys:[]},a.formLayout={labelCol:{span:7},wrapperCol:{span:13}},a}return(0,y.default)(t,e),(0,p.default)(t,[{key:"componentDidMount",value:function(){var e=this.props.dispatch;e({type:"role/getById",payload:this.state.formVals.id}),e({type:"role/getPermissionTreeByType"})}},{key:"render",value:function(){var e=this.props,t=e.updateModalVisible,a=e.handleUpdateModalVisible,l=this.state,r=l.currentStep,n=l.formVals;return D.default.createElement(k.default,{width:640,bodyStyle:{padding:"32px 40px 48px"},destroyOnClose:!0,title:(0,R.formatMessage)({id:"app.role.form.operation.deploy.title"}),visible:t,footer:this.renderFooter(r),onCancel:function(){return a()}},D.default.createElement(b.default,{style:{marginBottom:28},size:"small",current:r},D.default.createElement(K,{title:(0,R.formatMessage)({id:"app.role.form.operation.deploy.base"})}),D.default.createElement(K,{title:(0,R.formatMessage)({id:"app.role.form.operation.deploy.permissions"})}),D.default.createElement(K,{title:(0,R.formatMessage)({id:"app.role.form.operation.deploy.range"})})),this.renderContent(r,n))}}]),t}(D.PureComponent),C=w))||C)||C),I=(F=(0,U.connect)(function(e){var t=e.role,a=e.loading;return{role:t,loading:a.models.role}}),S=x.default.create(),F(N=S((T=function(e){function t(){var e,a;(0,c.default)(this,t);for(var l=arguments.length,r=new Array(l),n=0;n<l;n++)r[n]=arguments[n];return a=(0,m.default)(this,(e=(0,h.default)(t)).call.apply(e,[this].concat(r))),a.state={modalVisible:!1,updateModalVisible:!1,expandForm:!1,formValues:{},stepFormValues:{}},a.columns=[{title:(0,R.formatMessage)({id:"app.role.form.name"}),dataIndex:"name"},{title:(0,R.formatMessage)({id:"app.form.operation"}),render:function(e,t){return D.default.createElement(D.Fragment,null,D.default.createElement("a",{onClick:function(){return a.handleUpdateModalVisible(!0,t)}},(0,R.formatMessage)({id:"app.form.operation.deploy"})),D.default.createElement(i.default,{type:"vertical"}),D.default.createElement("a",{onClick:function(){return a.handleDelete(t)}},(0,R.formatMessage)({id:"app.form.delete"})))}}],a.handleModalVisible=function(e){a.setState({modalVisible:!!e})},a.handleUpdateModalVisible=function(e,t){a.setState({updateModalVisible:!!e,stepFormValues:t||{}})},a.handleFetch=function(){var e=a.props.dispatch;e({type:"role/fetch"})},a.handleReloadData=function(){a.timer&&clearTimeout(a.timer),a.timer=setTimeout(function(){a.handleFetch()},1e3)},a.handleAdd=function(e){var t=a.props.dispatch;t({type:"role/addRole",payload:e}),d.default.success((0,R.formatMessage)({id:"app.form.create.successMessage"})),a.handleModalVisible(),a.handleReloadData()},a.handleUpdate=function(e){var t=a.props.dispatch;t({type:"role/updateRole",payload:(0,f.default)({},e)}),d.default.success((0,R.formatMessage)({id:"app.form.operation.deploy.success"})),a.handleUpdateModalVisible(),a.handleReloadData()},a.handleDelete=function(e){var t=a.props.dispatch;t({type:"role/deleteRole",payload:e.id}),d.default.success((0,R.formatMessage)({id:"app.form.operation.delete.success"})),a.handleReloadData()},a}return(0,y.default)(t,e),(0,p.default)(t,[{key:"componentDidMount",value:function(){this.handleFetch()}},{key:"render",value:function(){var e=this,t=this.props,a=t.role.roles,l=t.loading,r=[];null!=a.result&&(r=a.result);var d=this.state,i=d.modalVisible,f=d.updateModalVisible,c=d.stepFormValues,p={handleAdd:this.handleAdd,handleModalVisible:this.handleModalVisible},m={handleUpdateModalVisible:this.handleUpdateModalVisible,handleUpdate:this.handleUpdate};return D.default.createElement(L.default,{title:(0,R.formatMessage)({id:"app.role"})},D.default.createElement(n.default,{bordered:!1},D.default.createElement("div",{className:O.default.tableList},D.default.createElement("div",{className:O.default.tableListOperator},D.default.createElement(s.default,{icon:"plus",type:"primary",onClick:function(){return e.handleModalVisible(!0)}},(0,R.formatMessage)({id:"app.form.create"}))),D.default.createElement(o.default,{columns:this.columns,loading:l,onChange:this.handleStandardTableChange,dataSource:r,rowKey:"id"}))),D.default.createElement(z,(0,u.default)({},p,{modalVisible:i})),c&&Object.keys(c).length?D.default.createElement(B,(0,u.default)({},m,{updateModalVisible:f,values:c})):null)}}]),t}(D.PureComponent),N=T))||N)||N),J=I;t.default=J}}]);